---
import Layout from "@/layouts/Layout.astro";
import blogs from "@/data/blog.json";
import Decoration from "@/components/Decoration.astro";
import CardBlog from "@/components/CardBlog.astro";

export async function getStaticPaths() {
    return blogs.map((b) => ({
        params: { id: b.id.toString() },
        props: { b },
    }));
}

const { b } = Astro.props;

if (!b) {
    return Astro.redirect("/404");
}

const blogsRelacionados = blogs
    .filter((blog) => blog.categoria === b.categoria && blog.id !== b.id)
    .slice(0, 4);
---

<Layout
    title={`${b.titulo} - Leandro y Mijail Joyería`}
    description={b.descripcion}
>
    <main class="min-h-screen bg-primary">
        <!-- Producto Principal -->
        <section class="pb-16 pt-32 px-6">
            <div class="max-w-7xl mx-auto">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-16 items-start">
                    <!-- Imagen del Producto -->
                    <div
                        class="space-y-6 animate-blurred-fade-in animate-delay-250"
                    >
                        <div class="relative group">
                            <div
                                class="aspect-square bg-gradient-to-br from-primary/20 to-primary/5 backdrop-blur-xl rounded-3xl border border-primary/20 overflow-hidden"
                            >
                                <img
                                    src={b.imagen}
                                    alt={b.titulo}
                                    class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-700"
                                    transition:name={`Blog-${b.id}`}
                                />

                                <!-- Badge destacado -->
                                {
                                    b.destacado && (
                                        <div class="absolute top-6 left-6 bg-gold-light/90 backdrop-blur-sm text-primary px-4 py-2 rounded-full text-sm font-bold">
                                            ⭐ Destacado
                                        </div>
                                    )
                                }
                            </div>
                        </div>
                    </div>

                    <!-- Información del Producto -->
                    <div class="space-y-8 animate-fade-in animate-delay-300">
                        <!-- Título y Precio -->
                        <div class="space-y-4">
                            <h1
                                class="text-4xl lg:text-5xl font-bold text-gold-light text-shadow-gold-light leading-tight"
                            >
                                {b.titulo}
                            </h1>
                        </div>

                        <!-- Descripción -->
                        <div class="space-y-4">
                            <h3
                                class="text-xl font-semibold text-shadow-silver-ligth"
                            >
                                Descripción
                            </h3>
                            <p class="text-gray-200 text-lg leading-relaxed">
                                {b.descripcion}
                            </p>
                        </div>

                        <!-- Características -->
                        <div class="space-y-4">
                            <h3
                                class="text-xl font-semibold text-shadow-silver-ligth"
                            >
                                Características
                            </h3>
                            <div class="grid grid-cols-3 gap-4">
                                <div
                                    class="bg-gradient-to-r from-primary/20 to-primary/10 backdrop-blur-xl rounded-xl p-4 border border-primary/20"
                                >
                                    <div class="text-gray-200 text-sm">
                                        Categoría
                                    </div>
                                    <div
                                        class="text-shadow-silver-ligth font-semibold capitalize"
                                    >
                                        {b.categoria}
                                    </div>
                                </div>

                                <div
                                    class="bg-gradient-to-r from-primary/20 to-primary/10 backdrop-blur-xl rounded-xl p-4 border border-primary/20"
                                >
                                    <div class="text-gray-200 text-sm">
                                        Fecha
                                    </div>
                                    <div
                                        class="text-shadow-silver-ligth font-semibold capitalize"
                                    >
                                        {b.fecha}
                                    </div>
                                </div>

                                <div
                                    class="bg-gradient-to-r from-primary/20 to-primary/10 backdrop-blur-xl rounded-xl p-4 border border-primary/20"
                                >
                                    <div class="text-gray-200 text-sm">
                                        Autor
                                    </div>
                                    <div
                                        class="text-shadow-silver-ligth font-semibold"
                                    >
                                        {b.autor}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Productos Relacionados -->
        {
            blogsRelacionados.length > 0 && (
                <section class="py-20 px-6">
                    <div class="max-w-7xl mx-auto">
                        <div class="text-center mb-16">
                            <Decoration
                                title="Blogs Relacionados"
                                subtitle={
                                    "Otros Blogs de la categoría " + b.categoria
                                }
                            />
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8 justify-center items-center">
                            {blogsRelacionados.map(
                                (blogsRelacionado, index) => (
                                    <div
                                        class="group"
                                        style={`animation-delay: ${index * 0.1}s`}
                                    >
                                        <CardBlog
                                            id={blogsRelacionado.id}
                                            titulo={blogsRelacionado.titulo}
                                            descripcion={
                                                blogsRelacionado.descripcion
                                            }
                                            autor={blogsRelacionado.autor}
                                            fecha={blogsRelacionado.fecha}
                                            categoria={
                                                blogsRelacionado.categoria
                                            }
                                            imagen={blogsRelacionado.imagen}
                                        />
                                    </div>
                                ),
                            )}
                        </div>
                    </div>
                </section>
            )
        }

        <!-- Call to Action -->
        <section class="pb-20 px-6">
            <div class="max-w-4xl mx-auto text-center">
                <div
                    class="bg-gradient-to-r from-primary/20 to-primary/10 backdrop-blur-xl rounded-3xl p-12 border border-primary/20"
                >
                    <Decoration
                        title="¿Te interesa nuestro contenido?"
                        subtitle="   Mantente al día con las últimas tendencias en joyería y recibe consejos exclusivos."
                    />

                    <div class="flex flex-col sm:flex-row gap-4 justify-center">
                        <a
                            href="/Blog"
                            class="group relative inline-flex items-center justify-center gap-3
                                   px-8 py-4 bg-gradient-to-r from-gold to-gold-light
                                   text-primary font-semibold text-lg rounded-xl
                                   shadow-lg shadow-gold/30
                                   hover:shadow-xl hover:shadow-gold/50
                                   hover:scale-105 hover:-translate-y-1
                                   transition-all duration-300
                                   focus:outline-none focus:ring-2 focus:ring-gold/50 focus:ring-offset-2
                                   active:scale-100 active:translate-y-0
                                   overflow-hidden min-w-[200px]"
                        >
                            <span>Volver</span>
                            <div
                                class="absolute inset-0 bg-gradient-to-r from-white/0 via-white/25 to-white/0
                                       translate-x-[-100%] transition-transform duration-700
                                       group-hover:translate-x-[100%]"
                            >
                            </div>
                        </a>
                    </div>
                </div>
            </div>
        </section>
    </main>
</Layout>

<style>
    .line-clamp-2 {
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }

    /* Animaciones para productos relacionados */
    @keyframes slideUp {
        from {
            opacity: 0;
            transform: translateY(30px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .group {
        animation: slideUp 0.6s ease-out both;
    }

    /* Efectos de hover mejorados */
    .group:hover .line-clamp-2 {
        -webkit-line-clamp: unset;
    }

    /* Transiciones suaves para view transitions */
    img[transition\\:name] {
        view-transition-name: var(--transition-name);
    }
</style>

<script>
    // Funcionalidad para cambiar imagen principal con miniaturas
    document.addEventListener("DOMContentLoaded", function () {
        const mainImage = document.querySelector(".aspect-square img");
        const thumbnails = document.querySelectorAll(".grid.grid-cols-4 img");

        thumbnails.forEach((thumbnail, index) => {
            thumbnail.addEventListener(
                "click",
                function (this: HTMLImageElement) {
                    // Remover clase activa de todas las miniaturas
                    thumbnails.forEach((thumb) => {
                        const parent = thumb.parentElement;
                        if (parent) {
                            parent.classList.remove("border-gold-light");
                        }
                    });

                    // Agregar clase activa a la miniatura clickeada
                    const parent = this.parentElement;
                    if (parent) {
                        parent.classList.add("border-gold-light", "border-2");
                    }

                    // Cambiar imagen principal (en un caso real, aquí cambiarías la src)
                    if (mainImage && mainImage instanceof HTMLImageElement) {
                        mainImage.style.transform = "scale(0.95)";
                        setTimeout(() => {
                            if (mainImage instanceof HTMLImageElement) {
                                mainImage.style.transform = "scale(1)";
                            }
                        }, 200);
                    }
                },
            );
        });

        // Botones de acción
        const solicitarInfoBtn = document.querySelector(
            'button:contains("Solicitar Información")',
        );
        const llamarBtn = document.querySelector(
            'button:contains("Llamar para Consulta")',
        );

        // Agregar funcionalidad a los botones
        document.querySelectorAll("button").forEach((button) => {
            if (button.textContent.includes("Solicitar Información")) {
                button.addEventListener("click", () => {
                    // Redirigir a contacto con parámetros del producto
                    const productId = window.location.pathname.split("/").pop();
                    window.location.href = `/Contacto?producto=${productId}`;
                });
            }

            if (button.textContent.includes("Llamar para Consulta")) {
                button.addEventListener("click", () => {
                    // Aquí podrías abrir el marcador telefónico
                    window.location.href = "tel:+1234567890";
                });
            }
        });
    });
</script>
