---
import Layout from "@/layouts/Layout.astro";
import productos from "@/data/productos.json";
import Decoration from "@/components/Decoration.astro";
import CardProductoExacto from "@/components/CardProductoExacto.astro";

export async function getStaticPaths() {
    return productos.map((producto) => ({
        params: { id: producto.id.toString() },
        props: { producto },
    }));
}

const { producto } = Astro.props;

if (!producto) {
    return Astro.redirect("/404");
}

// Productos relacionados (misma categor√≠a, excluyendo el actual)
const productosRelacionados = productos
    .filter((p) => p.categoria === producto.categoria && p.id !== producto.id)
    .slice(0, 4);

// Formatear precio
const formatPrice = (price: number) => {
    return new Intl.NumberFormat("es-ES", {
        style: "currency",
        currency: "EUR",
        minimumFractionDigits: 2,
    }).format(price);
};
---

<Layout
    title={`${producto.titulo} - Leandro y Mijail Joyer√≠a`}
    description={producto.descripcion}
>
    <main class="min-h-screen bg-primary">
        <!-- Breadcrumb -->
        <section class="pt-32 pb-8 px-6"></section>

        <!-- Producto Principal -->
        <section class="pb-16 px-6">
            <div class="max-w-7xl mx-auto">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-16 items-start">
                    <!-- Imagen del Producto -->
                    <div
                        class="space-y-6 animate-blurred-fade-in animate-delay-250"
                    >
                        <div class="relative group">
                            <div
                                class="aspect-square bg-gradient-to-br from-primary/20 to-primary/5 backdrop-blur-xl rounded-3xl border border-primary/20 overflow-hidden"
                            >
                                <img
                                    src={producto.imagen}
                                    alt={producto.titulo}
                                    class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-700"
                                    transition:name={`producto-${producto.id}`}
                                />

                                <!-- Badge destacado -->
                                {
                                    producto.destacado && (
                                        <div class="absolute top-6 left-6 bg-gold-light/90 backdrop-blur-sm text-primary px-4 py-2 rounded-full text-sm font-bold">
                                            ‚≠ê Destacado
                                        </div>
                                    )
                                }
                            </div>
                        </div>

                        <!-- Galer√≠a de miniaturas (simulada) -->
                        <div
                            class="grid grid-cols-4 gap-4 animate-blurred-fade-in animate-delay-250"
                        >
                            {
                                [1, 2, 3, 4].map((index) => (
                                    <div class="aspect-square bg-gradient-to-br from-primary/10 to-primary/5 rounded-xl border border-primary/20 cursor-pointer hover:border-gold-light/50 transition-colors">
                                        <img
                                            src={producto.imagen}
                                            alt={`${producto.titulo} - Vista ${index}`}
                                            class="w-full h-full object-cover rounded-xl opacity-80 hover:opacity-100 transition-opacity"
                                        />
                                    </div>
                                ))
                            }
                        </div>
                    </div>

                    <!-- Informaci√≥n del Producto -->
                    <div class="space-y-8 animate-fade-in animate-delay-300">
                        <!-- T√≠tulo y Precio -->
                        <div class="space-y-4">
                            <h1
                                class="text-4xl lg:text-5xl font-bold text-shadow-silver-ligth leading-tight"
                            >
                                {producto.titulo}
                            </h1>

                            <div class="flex items-center gap-4">
                                <span
                                    class="text-4xl font-bold text-gold-light"
                                >
                                    {formatPrice(producto.precio)}
                                </span>
                            </div>
                        </div>

                        <!-- Descripci√≥n -->
                        <div class="space-y-4">
                            <h3
                                class="text-xl font-semibold text-shadow-silver-ligth"
                            >
                                Descripci√≥n
                            </h3>
                            <p class="text-gray-200 text-lg leading-relaxed">
                                {producto.descripcion}
                            </p>
                        </div>

                        <!-- Caracter√≠sticas -->
                        <div class="space-y-4">
                            <h3
                                class="text-xl font-semibold text-shadow-silver-ligth"
                            >
                                Caracter√≠sticas
                            </h3>
                            <div class="grid grid-cols-2 gap-4">
                                <div
                                    class="bg-gradient-to-r from-primary/20 to-primary/10 backdrop-blur-xl rounded-xl p-4 border border-primary/20"
                                >
                                    <div class="text-gray-200 text-sm">
                                        Categor√≠a
                                    </div>
                                    <div
                                        class="text-shadow-silver-ligth font-semibold capitalize"
                                    >
                                        {producto.categoria}
                                    </div>
                                </div>
                                <div
                                    class="bg-gradient-to-r from-primary/20 to-primary/10 backdrop-blur-xl rounded-xl p-4 border border-primary/20"
                                >
                                    <div class="text-gray-200 text-sm">
                                        Estado
                                    </div>
                                    <div
                                        class="text-shadow-silver-ligth font-semibold"
                                    >
                                        {
                                            producto.disponible
                                                ? "Disponible"
                                                : "No disponible"
                                        }
                                    </div>
                                </div>
                                <div
                                    class="bg-gradient-to-r from-primary/20 to-primary/10 backdrop-blur-xl rounded-xl p-4 border border-primary/20"
                                >
                                    <div class="text-gray-200 text-sm">
                                        C√≥digo
                                    </div>
                                    <div
                                        class="text-shadow-silver-ligth font-semibold"
                                    >
                                        LM-{
                                            producto.id
                                                .toString()
                                                .padStart(4, "0")
                                        }
                                    </div>
                                </div>
                                <div
                                    class="bg-gradient-to-r from-primary/20 to-primary/10 backdrop-blur-xl rounded-xl p-4 border border-primary/20"
                                >
                                    <div class="text-gray-200 text-sm">
                                        Garant√≠a
                                    </div>
                                    <div
                                        class="text-shadow-silver-ligth font-semibold"
                                    >
                                        2 a√±os
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Botones de Acci√≥n -->
                        <div class="space-y-4">
                            {
                                producto.disponible ? (
                                    <div class="space-y-3 justify-center items-center flex flex-col ">
                                        <a
                                            href="https://wa.me/53538456111"
                                            target="_blank"
                                            rel="noopener noreferrer"
                                            class=" text-center w-full bg-gradient-to-r from-zafiro to-zafiro/80 hover:from-zafiro/90 hover:to-zafiro/70 text-silver-ligth font-bold py-4 px-8 rounded-xl shadow-lg shadow-zafiro/30 hover:shadow-xl hover:shadow-zafiro/50 hover:-translate-y-1 transition-all duration-300 text-lg"
                                        >
                                            üìû Llamar para Consulta
                                        </a>
                                    </div>
                                ) : (
                                    <button
                                        disabled
                                        class="w-full bg-gray-600/50 text-gray-400 font-bold py-4 px-8 rounded-xl cursor-not-allowed text-lg"
                                    >
                                        üö´ Producto No Disponible
                                    </button>
                                )
                            }
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Productos Relacionados -->
        {
            productosRelacionados.length > 0 && (
                <section class="py-20 px-6">
                    <div class="max-w-7xl mx-auto">
                        <div class="text-center mb-16">
                            <Decoration
                                title="Productos Relacionados"
                                subtitle={
                                    "Otros productos de la categor√≠a " +
                                    producto.categoria
                                }
                            />
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8 justify-center items-center">
                            {productosRelacionados.map(
                                (productoRelacionado, index) => (
                                    <div
                                        class="group"
                                        style={`animation-delay: ${index * 0.1}s`}
                                    >
                                        <CardProductoExacto
                                            id={productoRelacionado.id}
                                            titulo={productoRelacionado.titulo}
                                            descripcion={
                                                productoRelacionado.descripcion
                                            }
                                            precio={productoRelacionado.precio}
                                            imagen={productoRelacionado.imagen}
                                        />
                                    </div>
                                ),
                            )}
                        </div>
                    </div>
                </section>
            )
        }

        <!-- Call to Action -->
        <section class="pb-20 px-6">
            <div class="max-w-4xl mx-auto text-center">
                <div
                    class="bg-gradient-to-r from-primary/20 to-primary/10 backdrop-blur-xl rounded-3xl p-12 border border-primary/20"
                >
                    <Decoration
                        title="¬øTe interesa este producto?"
                        subtitle="   Cont√°ctanos para m√°s informaci√≥n, precios especiales o  para agendar una cita en nuestra joyer√≠a."
                    />

                    <div class="flex flex-col sm:flex-row gap-4 justify-center">
                        <a
                            href="/Contacto"
                            class="inline-flex items-center gap-3 px-8 py-4 bg-zafiro text-white font-semibold rounded-xl shadow-lg shadow-primary/30 hover:shadow-xl hover:shadow-primary/50 hover:-translate-y-1 transition-all duration-300"
                        >
                            Contactar
                            <svg
                                class="w-5 h-5"
                                fill="none"
                                stroke="currentColor"
                                viewBox="0 0 24 24"
                            >
                                <path
                                    stroke-linecap="round"
                                    stroke-linejoin="round"
                                    stroke-width="2"
                                    d="M13 7l5 5m0 0l-5 5m5-5H6"></path>
                            </svg>
                        </a>
                        <a
                            href="/Catalogo"
                            class="group relative inline-flex items-center justify-center gap-3
                                   px-8 py-4 bg-gradient-to-r from-gold to-gold-light
                                   text-primary font-semibold text-lg rounded-xl
                                   shadow-lg shadow-gold/30
                                   hover:shadow-xl hover:shadow-gold/50
                                   hover:scale-105 hover:-translate-y-1
                                   transition-all duration-300
                                   focus:outline-none focus:ring-2 focus:ring-gold/50 focus:ring-offset-2
                                   active:scale-100 active:translate-y-0
                                   overflow-hidden min-w-[200px]"
                        >
                            <span>Ver mas productos</span>
                            <div
                                class="absolute inset-0 bg-gradient-to-r from-white/0 via-white/25 to-white/0
                                       translate-x-[-100%] transition-transform duration-700
                                       group-hover:translate-x-[100%]"
                            >
                            </div>
                        </a>
                    </div>
                </div>
            </div>
        </section>
    </main>
</Layout>

<style>
    .line-clamp-2 {
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }

    /* Animaciones para productos relacionados */
    @keyframes slideUp {
        from {
            opacity: 0;
            transform: translateY(30px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .group {
        animation: slideUp 0.6s ease-out both;
    }

    /* Efectos de hover mejorados */
    .group:hover .line-clamp-2 {
        -webkit-line-clamp: unset;
    }

    /* Transiciones suaves para view transitions */
    img[transition\\:name] {
        view-transition-name: var(--transition-name);
    }
</style>

<script>
    // Funcionalidad para cambiar imagen principal con miniaturas
    document.addEventListener("DOMContentLoaded", function () {
        const mainImage = document.querySelector(".aspect-square img");
        const thumbnails = document.querySelectorAll(".grid.grid-cols-4 img");

        thumbnails.forEach((thumbnail, index) => {
            thumbnail.addEventListener(
                "click",
                function (this: HTMLImageElement) {
                    // Remover clase activa de todas las miniaturas
                    thumbnails.forEach((thumb) => {
                        const parent = thumb.parentElement;
                        if (parent) {
                            parent.classList.remove("border-gold-light");
                        }
                    });

                    // Agregar clase activa a la miniatura clickeada
                    const parent = this.parentElement;
                    if (parent) {
                        parent.classList.add("border-gold-light", "border-2");
                    }

                    // Cambiar imagen principal (en un caso real, aqu√≠ cambiar√≠as la src)
                    if (mainImage && mainImage instanceof HTMLImageElement) {
                        mainImage.style.transform = "scale(0.95)";
                        setTimeout(() => {
                            if (mainImage instanceof HTMLImageElement) {
                                mainImage.style.transform = "scale(1)";
                            }
                        }, 200);
                    }
                },
            );
        });

        // Botones de acci√≥n
        const solicitarInfoBtn = document.querySelector(
            'button:contains("Solicitar Informaci√≥n")',
        );
        const llamarBtn = document.querySelector(
            'button:contains("Llamar para Consulta")',
        );

        // Agregar funcionalidad a los botones
        document.querySelectorAll("button").forEach((button) => {
            if (button.textContent.includes("Solicitar Informaci√≥n")) {
                button.addEventListener("click", () => {
                    // Redirigir a contacto con par√°metros del producto
                    const productId = window.location.pathname.split("/").pop();
                    window.location.href = `/Contacto?producto=${productId}`;
                });
            }

            if (button.textContent.includes("Llamar para Consulta")) {
                button.addEventListener("click", () => {
                    // Aqu√≠ podr√≠as abrir el marcador telef√≥nico
                    window.location.href = "tel:+1234567890";
                });
            }
        });
    });
</script>
